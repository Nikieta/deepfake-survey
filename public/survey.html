<!DOCTYPE html>
<html>
<head>
  <title>Audio Listening Task</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f6f7fb;
      margin: 0;
      padding: 40px;
      color: #111827;
    }
    .container { max-width: 900px; margin: auto; }
    .card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      padding: 28px 32px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    .button-row {
      display:flex;
      justify-content:space-between;
      margin-top:20px;
    }
  </style>
</head>
<body>

<div class="container">
<div class="card">

<h2 id="progressText"></h2>

<audio controls id="audioPlayer"></audio>

<p><b>Q1. Which audio artifact is most prominent?</b></p>
<input type="radio" name="artifact" value="Robot"> Robot-like voice<br>
<input type="radio" name="artifact" value="Pauses"> Unnatural pauses<br>
<input type="radio" name="artifact" value="Repetition"> Word repetition<br>
<input type="radio" name="artifact" value="Prosody"> Prosody mismatch<br>
<input type="radio" name="artifact" value="Noise"> Background noise<br>

<p><b>Q2. Confidence?</b></p>
<input type="radio" name="confidence" value="Low"> Low
<input type="radio" name="confidence" value="Medium"> Medium
<input type="radio" name="confidence" value="High"> High

<p><b>Q3. Difficulty?</b></p>
<input type="radio" name="difficulty" value="Very Easy"> Very Easy
<input type="radio" name="difficulty" value="Easy"> Easy
<input type="radio" name="difficulty" value="Neutral"> Neutral
<input type="radio" name="difficulty" value="Difficult"> Difficult
<input type="radio" name="difficulty" value="Very Difficult"> Very Difficult

<p><b>Q4. Comments</b></p>
<textarea id="comments"></textarea>

<div class="button-row">
  <button onclick="goBack()">Back</button>
  <button onclick="submitAndNext()">Next</button>
</div>

</div>
</div>

<script>

const APPS_SCRIPT_URL = "PASTE_YOUR_DEPLOYED_WEBAPP_URL_HERE";

/* ---------- STABLE PARTICIPANT ID ---------- */
let participantID = localStorage.getItem("participantID");
if (!participantID) {
  participantID = Date.now().toString();
  localStorage.setItem("participantID", participantID);
}

/* ---------- AUDIO FILES ---------- */
let audioFiles = [
  "audio/DF_E_2000013.flac",
  "audio/DF_E_2000024.flac",
  "audio/DF_E_2000026.flac",
  "audio/DF_E_2000042.flac",
  "audio/DF_E_2000048.flac",
  "audio/DF_E_2000053.flac",
  "audio/DF_E_2000055.flac",
  "audio/DF_E_2000075.flac",
  "audio/DF_E_2000079.flac",
  "audio/DF_E_2000091.flac",
  "audio/DF_E_2000100.flac",
  "audio/DF_E_2000102.flac",
  "audio/DF_E_2000508.flac",
  "audio/DF_E_2000524.flac",
  "audio/DF_E_2749699.flac",
  "audio/DF_E_2749700.flac",
  "audio/DF_E_2749711.flac",
  "audio/DF_E_2749732.flac",
  "audio/DF_E_2749783.flac",
  "audio/DF_E_2749817.flac"
];

audioFiles.sort(() => Math.random() - 0.5);

let currentIndex = 0;
let responses = {};

const audioPlayer = document.getElementById("audioPlayer");

function loadSample(index) {

  audioPlayer.src = audioFiles[index];
  audioPlayer.load();

  document.getElementById("progressText").innerText =
    `Sample ${index + 1} of ${audioFiles.length}`;

  // restore old response if exists
  if (responses[index]) {
    const r = responses[index];
    document.querySelector(`input[name="artifact"][value="${r.artifact}"]`)?.checked = true;
    document.querySelector(`input[name="confidence"][value="${r.confidence}"]`)?.checked = true;
    document.querySelector(`input[name="difficulty"][value="${r.difficulty}"]`)?.checked = true;
    document.getElementById("comments").value = r.comments;
  } else {
    document.querySelectorAll("input[type=radio]").forEach(r => r.checked = false);
    document.getElementById("comments").value = "";
  }
}

loadSample(currentIndex);

/* ---------- BACK BUTTON ---------- */
function goBack() {
  if (currentIndex === 0) return;
  currentIndex--;
  loadSample(currentIndex);
}

/* ---------- SUBMIT ---------- */
function submitAndNext() {

  const artifact = document.querySelector('input[name="artifact"]:checked');
  const confidence = document.querySelector('input[name="confidence"]:checked');
  const difficulty = document.querySelector('input[name="difficulty"]:checked');

  if (!artifact || !confidence || !difficulty) return;

  responses[currentIndex] = {
    artifact: artifact.value,
    confidence: confidence.value,
    difficulty: difficulty.value,
    comments: document.getElementById("comments").value
  };

  const payload = {
    participantID: participantID,
    sampleNumber: currentIndex + 1,
    artifact: artifact.value,
    confidence: confidence.value,
    difficulty: difficulty.value,
    comments: document.getElementById("comments").value
  };

  fetch(APPS_SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    body: JSON.stringify(payload)
  });

  currentIndex++;

  if (currentIndex >= audioFiles.length) {
    window.location.href = "thankyou.html";
    return;
  }

  loadSample(currentIndex);
}

</script>
</body>
</html>
